---
title: "WebSocketとSocket.IOの基礎知識"
---

# 第1章

現代のウェブアプリケーションでは、ユーザーが操作するたびにページ全体を再読み込みすることなく、データがリアルタイムに更新されることが期待されます。チャットのメッセージ、SNSの通知、株価の変動、オンラインゲームのプレイヤーの動きなど、即時性が求められる機能は数多く存在します。本章では、こうしたリアルタイム通信を実現するための基本的な技術である「WebSocket」と、それをより扱いやすくするライブラリ「Socket.IO」について、その仕組みとメリットを解説します。

## 1-1. リアルタイム通信の必要性

従来のウェブの基本的な通信モデルは、クライアント（ブラウザ）がサーバーにリクエストを送り、サーバーがそれに対してレスポンスを返すという「HTTPリクエスト/レスポンスモデル」でした。これは、ユーザーがリンクをクリックしたり、フォームを送信したりといった能動的なアクションを起点とする通信には適しています。

しかし、サーバー側で発生したイベント（例：他のユーザーからのメッセージ受信）を即座にクライアントに伝えたい場合、このモデルでは非効率です。クライアントが定期的に「何か新しい情報はありますか？」とサーバーに問い合わせ（ポーリング）続ける必要があり、これには以下のような課題がありました。

*   **遅延（Latency）**: ポーリングの間隔より短い時間で発生したイベントは、次のポーリングまでクライアントに届きません。
*   **サーバー負荷**: 多くのクライアントが頻繁にポーリングを行うと、サーバーへのリクエスト数が膨大になります。
*   **通信の無駄**: 何も更新がない場合でも、リクエストとレスポンスの通信が発生してしまいます。

これらの課題を解決し、より効率的で低遅延な双方向通信を実現するために登場したのがWebSocketです。

## 1-2. WebSocketとは？ - HTTPとの違いと双方向通信の仕組み

WebSocketは、単一のTCP接続上でクライアントとサーバー間の**全二重通信（Full-Duplex Communication）**を可能にする通信プロトコルです。一度接続が確立されると、クライアントとサーバーのどちらからでも、いつでも自由にメッセージを送り合うことができます。

| 特徴               | HTTP                                                     | WebSocket                                              |
| :----------------- | :------------------------------------------------------- | :----------------------------------------------------- |
| **通信方向**       | クライアント → サーバーの一方向（リクエスト/レスポンス） | 双方向                                                 |
| **接続状態**       | ステートレス（通信ごとに接続と切断を繰り返す）           | ステートフル（一度接続を確立すると維持される）         |
| **オーバーヘッド** | リクエストごとにヘッダー情報が付与され、比較的大きい     | 最初の接続（ハンドシェイク）後は最小限のデータで通信   |
| **主な用途**       | ドキュメントの取得、フォーム送信など                     | リアルタイムチャット、オンラインゲーム、ライブ通知など |

**通信の仕組み:**
WebSocketの通信は、「ハンドシェイク」と呼ばれる特別なHTTPリクエストから始まります。クライアントは、HTTPリクエストのヘッダーに「この通信をWebSocketにアップグレードしたい」という情報を含めてサーバーに送信します。サーバーがWebSocketに対応していれば、プロトコルをHTTPからWebSocketに切り替えて接続を確立します。一度この接続が確立されると、あとはその接続を「パイプ」のように使って、両者が自由にデータを送受信できるようになります。

## 1-3. Socket.IOとは？ - WebSocketとの関係と利用するメリット

Socket.IOは、WebSocketの技術をベースに、より信頼性が高く、便利な機能を追加したJavaScriptライブラリです。 Socket.IOはWebSocketの実装そのものではなく、WebSocketを可能な限り利用しつつ、それが使えない環境でも代替手段を用いてリアルタイム通信を実現する、より高レベルなライブラリと位置づけられています。

**Socket.IOを利用する主なメリット:**

*   **フォールバック機能**: クライアントのブラウザが古かったり、ネットワーク環境（プロキシなど）によってWebSocket接続がブロックされたりする場合、Socket.IOは自動的にHTTPロングポーリングなどの代替通信方式に切り替えます。 これにより、開発者は環境の違いを意識することなく、安定したリアルタイム通信を実装できます。
*   **自動再接続**: ネットワークが不安定で一時的に接続が切断された場合でも、Socket.IOは自動的にサーバーへの再接続を試みます。
*   **イベントベースの簡単なAPI**: `emit`でイベントを送信し、`on`でイベントを待ち受けるという、直感的で分かりやすいAPIを提供します。
    ```javascript
    // サーバーサイド: 'hello'というイベントをクライアントに送信
    io.emit("hello", "world");

    // クライアントサイド: 'hello'イベントを受信
    socket.on("hello", (arg) => {
      console.log(arg); // "world"
    });
    ```
*   **ブロードキャストとルーム機能**: 全ての接続クライアントへ一斉にメッセージを送る「ブロードキャスト」や、特定のクライアントグループ（例：チャットルームの参加者）にだけメッセージを送る「ルーム」機能が簡単に利用できます。

